<?require_once('classes/config.class.php');class artClass{	function getArticles($gid)	{		$ret = array();		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");		$query = "SELECT id, uid, title, timestamp FROM articles WHERE fid = '$gid' AND active = 1 ORDER BY timestamp DESC";		$ath = mysql_query($query);		if($ath)		{			while($thr = mysql_fetch_array($ath))			{				$str=array("id"=>$thr['id'], "uid"=>$thr['uid'], "title"=>$thr['title'], "timestamp"=>$thr['timestamp']);				$ret[] = $str;			}		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}		if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function getArticle($aid)	{		$ret = array();		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");				$query = "SELECT fid, uid, title, body, timestamp, approoved FROM articles WHERE id = '$aid'";		$ath = mysql_query($query);		if($ath)		{			while($thr = mysql_fetch_array($ath))			{				$str=array("fid"=>$thr['fid'], "uid"=>$thr['uid'], "title"=>$thr['title'], "timestamp"=>$thr['timestamp'], "body"=>$thr['body'], "approoved"=>$thr['approoved']);				$ret[] = $str;			}		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}				if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function approoveArticle($aid, $uid)	{		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");				$query = "UPDATE articles SET active = 1, approoved = $uid WHERE id = $aid";		$ath = mysql_query($query);		if($ath)		{			$ret = 1;		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}				if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function removeArticle($aid)	{		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");				$query = "DELETE FROM articles WHERE id = $aid";		$ath = mysql_query($query);		if($ath)		{			$ret = 1;		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}				if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function moveArticle($id, $new_fid)	{		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");				$query = "UPDATE articles SET fid = '$new_fid' WHERE id = '$id'";		$ath = mysql_query($query);		if($ath)		{			$ret = 1;		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}				if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function addArticle($fid, $title, $body, $timestamp, $uid)	{		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");		$body = mysql_real_escape_string($body);	$title = mysql_real_escape_string($title);	$query = "INSERT INTO articles(fid, title, body, timestamp, uid, active) VALUES('$fid', '$title', '$body', '$timestamp', '$uid', 0)";		$ath = mysql_query($query);		if($ath)		{			$ret = 1;		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}				if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function getUnapprooved()	{		$ret = array();		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");		$query = "SELECT id, uid, title, body, timestamp FROM articles WHERE active = 0 ORDER BY timestamp DESC";		$ath = mysql_query($query);		if($ath)		{			while($thr = mysql_fetch_array($ath))			{				$by = base::eread('users', 'nick', null, 'id', $thr['uid']);				$str=array("id"=>$thr['id'], "title"=>$thr['title'], "timestamp"=>$thr['timestamp'], "text"=>$thr['body'], "by"=>$by, "isVote"=>'-1');				$ret[] = $str;			}		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}		if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function getSections()	{		$ret = array();		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");				$ath = mysql_query("SELECT forum_id, name, description, rewrite FROM forums ORDER BY sort;");		if($ath)		{			while($forums = mysql_fetch_array($ath))			{				$fid = $forums['forum_id'];				$sum_q = mysql_query("SELECT COUNT(id) FROM articles WHERE fid= '$fid' AND active=1");				if($sum_q)				{					if($in_sum = mysql_fetch_array($sum_q))					{						$all = $in_sum[0] > 0 ? $in_sum[0] : '-';					}					else					{						$all = '-';					}				}				else				{					echo "<p><b>Error: ".mysql_error()."</b></p>";					$ret = 0;				}													$from_time_day = mktime(0, 0, 0, date('m'), date('d'), date('Y'));				$to_time_day = mktime(23, 59, 59, date('m'), date('d'), date('Y'));				$day_q = mysql_query("SELECT COUNT(id) FROM articles WHERE fid= '$fid' AND active=1 AND ('$from_time_day' - timestamp) <= ('$to_time_day' - '$from_time_day')");				if($day_q)				{					if($in_day = mysql_fetch_array($day_q))					{						$day = $in_day[0] > 0 ? $in_day[0] : '-';					}					else					{						$day = '-';					}				}				else				{					echo "<p><b>Error: ".mysql_error()."</b></p>";					$ret = 0;				}									$from_time_hour = mktime(date('H'), 0, 0, date('m'), date('d'), date('Y'));				$to_time_hour = mktime(date('H'), 0, 0, date('m'), date('d'), date('Y')) +3599;				$hour_q = mysql_query("SELECT COUNT(id) FROM articles WHERE fid= '$fid' AND active=1 AND timestamp >= '$from_time_hour' AND ('$from_time_hour' - timestamp) <= 3599");				if($hour_q)				{					if($in_hour = mysql_fetch_array($hour_q))					{						$hour = $in_hour[0] > 0 ? $in_hour[0] : '-';					}					else					{						$hour = '-';					}				}				else				{					echo "<p><b>Error: ".mysql_error()."</b></p>";					$ret = 0;				}				$str = array("fid"=>$forums['forum_id'], "name"=>$forums['name'], "description"=>$forums['description'], "rewrite"=>$forums['rewrite'], "in_sum"=>$all, "in_day"=>$day, "in_hour"=>$hour);				$ret[] = $str;			}		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}				if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");		}		return $ret;	}		function editArticle($aid, $subj, $mes)	{		$ret;		$dbcnx = @mysql_connect($GLOBALS['db_host'], $GLOBALS['db_user'], $GLOBALS['db_pass']); 		if (!$dbcnx) 		{			echo ("<P>¬ насто€щий момент сервер базы данных не доступен, поэтому корректное отображение страницы невозможно.</P>");			$ret = 0;		}		mysql_query("SET NAMES utf8");		$query = "UPDATE articles SET title = '$subj', body='$mes' WHERE id = '$aid'";		$ath = mysql_query($query);		if($ath)		{						$ret = 1;		}		else		{			echo "<p><b>Error: ".mysql_error()."</b></p>";			$ret = 0;		}		if(!mysql_close($dbcnx))		{			echo("Ќе удалось завершить соединение");			$ret = 0;		}		return $ret;	}	}?>